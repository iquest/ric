<script>
	function moveEvent(calendarEventId, start, end, revertFunc) {
		var calendarEvent = {};
		var startDateTime = (start ? start.format() : null);
		var endDateTime = (end ? end.format() : startDateTime);

		if (start.hasTime()) {
			// Move to another time
			calendarEvent = {
				all_day: false,
				start_date: startDateTime,
				start_time: startDateTime,
				end_date: endDateTime,
				end_time: endDateTime,
			};
		}
		else {
			// Move to all day activity
			calendarEvent = {
				all_day: true,
				start_date: startDateTime,
				start_time: startDateTime,
				end_date: endDateTime,
				end_time: endDateTime,
			};
		}

		$.post({
			url: Routes.ric_calendar_calendar_event_path(calendarEventId),
			data: {
				calendar_event: calendarEvent,
				_method: "PATCH",
			},
			dataType: 'json',
			success: function() {
			},
			error: function() {
				revertFunc();
			},
		});
	}

	$(document).ready(function() {
		$('.ric-calendar').fullCalendar({
			header: {
					left: 'prev,next today',
					center: 'title',
					right: 'month,agendaWeek,agendaDay,listWeek'
			},
			//height: "auto",
			aspectRatio: 2,
			navLinks: true, // can click day/week names to navigate views
			editable: false, // Would be overriden in editable events
			eventLimit: true, // allow "more" link when too many events
			events: '<%= events_calendar_index_path %>',
			scrollTime: "8:00:00", // Where to start showing calendar in agenda
			timeFormat: "H:mm", // Show 8:00 instead of 8

			eventDrop: function(event, delta, revertFunc) {
				moveEvent(event.objectId, event.start, event.end, revertFunc);
			},
			eventResize: function(event, delta, revertFunc) {
				moveEvent(event.objectId, event.start, event.end, revertFunc);
			}
		});
	});

</script>
